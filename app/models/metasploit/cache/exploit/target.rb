# Target of an {Metasploit::Cache::Exploit::Instance exploit Metasploit Module}.  Targets have specific architectures
# and platforms that customize the behavior of the exploit Metasploit Module.
class Metasploit::Cache::Exploit::Target < ActiveRecord::Base
  #
  # Associations
  #

  # Joins {#architectures} to this target.
  has_many :architecturable_architectures,
           class_name: 'Metasploit::Cache::Architecturable::Architecture',
           dependent: :destroy,
           inverse_of: :architecturable

  # {Metasploit::Cache::Exploit::Instance Exploit Metasploit Module} on which this is a target.
  belongs_to :exploit_instance,
             class_name: 'Metasploit::Cache::Exploit::Instance',
             inverse_of: :exploit_targets

  #
  # through: :architecturable_architectures
  #

  # The architectures targeted by this target.
  has_many :architectures,
           class_name: 'Metasploit::Cache::Architecture',
           through: :architecturable_architectures

  #
  # Attributes
  #

  # @!attribute index
  #   @note Does not imply that this is the index of this target in
  #     {Metasploit::Cache::Exploit::Instance#exploit_targets}.
  #
  #   The index of this target in the array of targets as declared on the {#exploit_instance exploit Metasploit Module}
  #   source.
  #
  #   @return [Integer]

  # @!attribute name
  #   The name of this target.
  #
  #   @return [String]

  #
  # Validations
  #

  validates :architecturable_architectures,
            length: {
                minimum: 1
            }
  validates :exploit_instance,
            presence: true
  validates :index,
            presence: true,
            uniqueness: {
                scope: :exploit_instance_id
            }
  validates :name,
            presence: true,
            uniqueness: {
                scope: :exploit_instance_id
            }

  #
  # Instance Methods
  #

  # @!method index=(index)
  #   Sets {#index}
  #
  #   @param index [Integer] The index of this target in the array of targets as declared on the
  #     {#exploit_instance exploit Metasploit Module} source.
  #   @return [void]

  # @!method name=(name)
  #   Sets {#name}.
  #
  #   @param name [String] name of this target.
  #   @return [void]

  Metasploit::Concern.run(self)
end