# Module Type: <%= exploit_class.ancestor.module_type %>
# Reference Name: <%= exploit_class.ancestor.reference_name %>
class <%= metasploit_class_relative_name %> < <%= superclass %>
  #
  # CONSTANTS
  #

  Rank = <%= exploit_class.rank.number %>

  #
  # Instance Methods
  #

  # Default architecture abbreviations for {#targets} that don't declare their own architecture abbreviations.
  #
  # @return [Array<String>]
  def arch
    []
  end

  def author
    [
<%- separate(contributions, ',') do |contribution, separator| -%>
  <%- email_address = contribution.email_address

      if email_address
        email = "'#{email_address.full}'"
      else
        email = "nil"
      end
  -%>
      OpenStruct.new(name: '<%= contribution.author.name %>', email: <%= email %>)<%= separator %>
<%- end -%>
    ]
  end

  def default_target
<%- if default_exploit_target -%>
    <%= default_exploit_target.index %>
<%- else -%>
    nil
<%- end -%>
  end

  def description
    '<%= description %>'
  end

  def disclosure_date
    Date.parse('<%= disclosed_on %>')
  end

  def license
    [
<%- separate(licensable_licenses, ',') do |licensable_license, separator| -%>
      '<%= licensable_license.license.abbreviation %>'<%= separator %>
<%- end -%>
    ]
  end

  def name
    '<%= name %>'
  end

  # Default platform list for {#targets} that don't declare their own platform list.
  #
  # @return [#platforms]
  def platform
    OpenStruct.new(
      platforms: []
    )
  end

  # Targets of this exploit.
  #
  # @return [Array<#arch, #name, #platform>]
  def targets
    [
<%- separate(exploit_targets, ',') do |exploit_target, exploit_target_separator| -%>
      OpenStruct.new(
        arch: [
  <%- separate(exploit_target.architecturable_architectures, ',') do |architecturable_architecture, architecturable_architecture_separator| -%>
          '<%= architecturable_architecture.architecture.abbreviation %>'<%= architecturable_architecture_separator %>
  <%- end -%>
        ],
        name: '<%= exploit_target.name %>',
        platform: OpenStruct.new(
                    platforms: [
  <%- separate(exploit_target.platformable_platforms, ',') do |platformable_platform, platformable_platform_separator| -%>
                      OpenStruct.new(
                        realname: '<%= platformable_platform.platform.fully_qualified_name %>'
                      )<%= platformable_platform_separator %>
  <%- end -%>
                    ]
                  )
      )<%= exploit_target_separator %>
<%- end -%>
    ]
  end
end